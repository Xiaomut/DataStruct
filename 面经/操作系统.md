# 操作系统

## 操作系统对于内存怎么管理的

- 程序重定位
- 分段
- 分页
- 虚拟内存
- 按需分页虚拟内存


为了在多进程环境下，使得进程之间的内存地址不受影响，相互隔离，于是操作系统就为每个进程独立分配一套的 `虚拟地址空间`。操作系统会通过 `内存交换技术`，把不常使用的内存暂时存放到硬盘（换出），在需要的时候再装载回物理内存（换入）。对于虚拟地址与物理地址的映射关系，可以有 分段和 分页的方式，同时两者结合都是可以的。

## 进程、线程、协程
1. 操作系统会以`进程`为单位，分配系统资源（CPU时间片、内存等资源），进程是资源分配的最小单位。
- `进程间通信（IPC）: `管道(Pipe)、命名管道(FIFO)、消息队列(Message Queue) 、信号量(Semaphore) 、共享内存（Shared Memory）；套接字（Socket）。

2. `线程，`有时被称为轻量级进程(Lightweight Process，LWP），是操作系统调度（CPU调度）执行的最小单位。

- `【区别】: `

    - `调度: `线程作为调度和分配的基本单位，进程作为拥有资源的基本单位

    - `层级: ` 进程包含线程，线程是进程的子任务，一个线程只属于一个进程，但一个进程包含多个线程

    - `内存资源: `不同的进程有各自独立的内存空间。而一个进程的线程间共享进程的内存资源。虽然多个线程共享 代码段、数据段、堆，但是每个线程有自己独立的栈用于存放局部变量和临时变量。

    - `系统开销: `在创建或撤消进程时，由于系统都要为之分配和回收资源，导致系统的开销明显大于创建或撤消线程时的开销。但是进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个进程死掉就等于所有的线程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。

- `【联系】: `

    - 一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程；
    - 资源分配给进程，同一进程的所有线程共享该进程的所有资源；
    - 处理机分给线程，即真正在处理机上运行的是线程；
    - 线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。

3. `协程`，是一种比线程更加轻量级的存在，协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。

- `极高的执行效率: `因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显；

- `不需要多线程的锁机制: `因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。
## 线程可以共享进程的哪些资源

`所属线程的栈区`、`程序计数器`、`栈指针` 以及 `函数运行使用的寄存器` 是线程私有的

- 地址空间
    - 栈区
    - 堆区
    - 代码区
    - 数据区

## 操作系统的特点

- 并发
    - 并发和并行的区别。并发是在一段时间内，多个操作均有进行。并行是在同一时刻，多个操作同时进行。并行需要物理系统的支持，如多核处理器、分布式计算系统等。操作系统通过进程和线程的概念实现了并发。
- 共享
    - 系统中的资源可以被多个进程共同使用。
    - 互斥共享与同步共享。 互斥资源也被称作是临界资源，同一时刻只能有一个进程访问，需要使用同步机制来实现互斥访问。
- 虚拟
    - 把物理实体转换为逻辑实体。
    - 计算资源和存储空间的虚拟。 在单核CPU上做到了时分复用，多个进/线程并发执行。在内存上，实现了空分复用，通过逻辑地址和换页算法实现了虚拟内存。
- 异步
    - 程序并不是一次性执行完毕，走走停停，以不可知的速度前进。